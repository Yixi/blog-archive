<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="一兮生活工作点点滴滴">
<meta property="og:url" content="http://blog.liuyixi.com/page/4/index.html">
<meta property="og:site_name" content="一兮生活工作点点滴滴">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="一兮生活工作点点滴滴">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> 一兮生活工作点点滴滴 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">一兮生活工作点点滴滴</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">关注前端</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Arquivos
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/04/29/3drouputuangaoqingxiazai/" itemprop="url">
                  3D肉蒲团高清下载
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Postado em
            <time itemprop="dateCreated" datetime="2011-04-29T13:00:25+08:00" content="2011-04-29">
              2011-04-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; Em
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/影评/" itemprop="url" rel="index">
                    <span itemprop="name">影评</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/影评/评论/" itemprop="url" rel="index">
                    <span itemprop="name">评论</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>各位看官淡定。。</p>
<p>我是做关键词实验的。。</p>
<p>下载木有。</p>
<p>话说，我手贱看了枪版。</p>
<p>感觉没啥特别。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/04/28/faxianbokehuanyouzhegechajian/" itemprop="url">
                  Audio Player不显示问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Postado em
            <time itemprop="dateCreated" datetime="2011-04-28T16:42:52+08:00" content="2011-04-28">
              2011-04-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; Em
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/网络琐事/" itemprop="url" rel="index">
                    <span itemprop="name">网络琐事</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>发现博客还有这个插件</p>
<p>[audio:<a href="http://product.3g.21cn.com/ct_hub/music/008.mp3|autostart=yes|loop=yes" target="_blank" rel="external">http://product.3g.21cn.com/ct_hub/music/008.mp3|autostart=yes|loop=yes</a>]</p>
<p>这玩意半年未一直都不显示，google了一下，找到了解决办法：</p>
<p>检查模板header.php的&lt;/head&gt;前是否有&lt;?php wp_head(); ?&gt;<br>检查模板footer.php的&lt;/body&gt;前是否有&lt;?php wp_footer(); ?&gt;</p>
<p>使用参数</p>
<p>Option    Effect<br>autostart=yes    是否自动播放(默认设置为 no不自动播放)<br>loop=yes    是否循环播放 (默认设置为 no 不循环播放)<br>bg=0xHHHHHH    背景色设置(在 HHHHHH 的地方用颜色代码替换如 FFFFFF或009933等)<br>leftbg=0xHHHHHH    左背景色<br>rightbg=0xHHHHHH    右背景色<br>rightbghover=0xHHHHHH    鼠标经过时右背景色<br>lefticon=0xHHHHHH    左图标色<br>righticon=0xHHHHHH    右图标色<br>righticonhover=0xHHHHHH    鼠标经过时右图标色<br>text=0xHHHHHH    文字色<br>slider=0xHHHHHH    播放轨迹指示滑块色<br>loader=0xHHHHHH    播放轨迹已播放部分背景色<br>track=0xHHHHHH    播放轨迹为播放部分背景色<br>border=0xHHHHHH    播放轨迹边框色</p>
<p>&nbsp;</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/04/27/gnome3/" itemprop="url">
                  gnome3
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Postado em
            <time itemprop="dateCreated" datetime="2011-04-27T17:08:49+08:00" content="2011-04-27">
              2011-04-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; Em
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/琐事/" itemprop="url" rel="index">
                    <span itemprop="name">琐事</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/琐事/网络琐事/" itemprop="url" rel="index">
                    <span itemprop="name">网络琐事</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>昨天把我电脑那万年不更新的Arch Linux更新了一下，为了想体验下gnome3。</p>
<p><a href="http://blog.liuyixi.com/wp-content/uploads/2011/04/archlinuxupdate.jpg"><img src="http://blog.liuyixi.com/wp-content/uploads/2011/04/archlinuxupdate.jpg" alt="" title="archlinuxupdate"></a></p>
<p>经过近2小时的等待，以及中间各种包冲突问题……(此处省略1000字)….</p>
<p>系统终于是最新的了，然后打开pacman.conf的testing仓库，继续更新…..</p>
<p>又是半个小时的等待…</p>
<p>终于，又是最新了，迫不及待的启动gdm，选择gnome启动，进去后发现没什么大的变化，感觉只是主题变了下而已。</p>
<p>网上查了下发现原来是没有装gnome-shell，然后继续安装gnome-shell，重启X。</p>
<p>这次好了，UI变动果然很给力啊，看得出来有很多MAC的影子。</p>
<p>只是，昨天晚上玩了一会，在选择active的时候，展示所有活动窗口时假死两次，假死时只鼠标能移动，crtl+alt+F1想切回控制台也没反应。。鉴于太晚了，所以放弃。</p>
<p>今天中午又折腾了一下，不到10分钟，也是在active页面又假死，遂放弃了折腾，睡午觉。</p>
<p>本来还想配置好后把开发环境搬回linux，可这个假死让我打消了念头。</p>
<p>而且输入法还有冲突问题。</p>
<p>我还是乖乖的继续用我的WIN7吧，生产环境乱动不得。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/04/26/xinyumingliuyixi-comqidong/" itemprop="url">
                  新域名 Liuyixi.com 启动
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Postado em
            <time itemprop="dateCreated" datetime="2011-04-26T12:39:27+08:00" content="2011-04-26">
              2011-04-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; Em
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/琐事/" itemprop="url" rel="index">
                    <span itemprop="name">琐事</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/琐事/网络琐事/" itemprop="url" rel="index">
                    <span itemprop="name">网络琐事</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>貌似我一年换一个域名的频率   (⊙o⊙)…</p>
<p>从 liuyixi.cn 到 yixi.info 再到 liuyixi.com</p>
<p>嗯，做友情链接的看到这篇麻烦更换下链接。</p>
<p>当然随意。</p>
<p>yixi.info这个域名依然还是会用的。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/04/23/jsjiantingtextchangeshijian/" itemprop="url">
                  js监听text change 事件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Postado em
            <time itemprop="dateCreated" datetime="2011-04-23T14:17:10+08:00" content="2011-04-23">
              2011-04-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; Em
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Firefox/" itemprop="url" rel="index">
                    <span itemprop="name">Firefox</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Firefox/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>监听输入区域的改变，这里推荐一个jquery的插件：<br><a href="http://www.zurb.com/playground/jquery-text-change-custom-event" target="_blank" rel="external">http://www.zurb.com/playground/jquery-text-change-custom-event</a></p>
<p>这个可以监听到内容输入区域内容的实时变化，但是有个小小的不足，就是不能监听到firefox下 设置了contenteditable=”true” 的DIV区域的拖拽文字变化。</p>
<p>后来针对firefox下的这种情况写了个简单的处理函数。</p>
<p><pre lang="javascript" line="1" file="download.txt" colla="+"></pre></p>
<p><div id="content" contenteditable="true" style="width:500px;height:30px;background:#c1c1c1;"></div></p>
<p><script><br>    var text=””;<br>    function binchange(){<br>        var t= $(‘#content’).html();<br>        if(t!=text){<br>            console.log(‘change’,text+’ to ‘+t);<br>            text = t;<br>        }<br>        setTimeout(‘binchange()’,3000)<br>    }<br>       binchange();<br>    </script><br><br>可以控制settimeout部分的时间参数来控制探测的时间。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/04/15/toubuxiaobujian/" itemprop="url">
                  头部小部件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Postado em
            <time itemprop="dateCreated" datetime="2011-04-15T16:14:00+08:00" content="2011-04-15">
              2011-04-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; Em
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/网络琐事/" itemprop="url" rel="index">
                    <span itemprop="name">网络琐事</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>在博客主题的头部放了一个HTML5 canvas的小东西，嗯 IE9以下慎入。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/04/15/innerhtmlhecreatelementdequbie/" itemprop="url">
                  innerHTML 和 creatElement 的区别
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Postado em
            <time itemprop="dateCreated" datetime="2011-04-15T14:44:31+08:00" content="2011-04-15">
              2011-04-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; Em
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>在某些时候，我们需要使用js动态的对DOM进行添加操作。比如我们需要添加一段 &lt;div id=”foot”&gt;&lt;/div&gt;，这个时候有两个选择：</p>
<p>第一是使用 innerHTML</p>
<pre lang="javascript" line="1" file="download.txt" colla="+">
document.body.innerHTML+='<div id="foot"></div>';
</pre>
第二种事使用 createElement方法

<pre lang="javascript" line="1" file="download.txt" colla="+">
var newdiv = document.createElement('div');
newdiv.id="foot";
document.body.appendChild(newdiv);
</pre>

<p>两种方法都可以实现，但看起来第一种方法要简单的多，而且如果需要添加的DOM比较发杂，第二种方法会更繁琐。</p>
<p>两种方式的区别在哪里？</p>
<p>第一种方式的原理在把原有的body部分的html取出来加上foot那段DIV，然后再写入body内，所以可能会造成所谓的“闪烁”<br>而第二种方式是用的对象创建的方法去添加DOM。</p>
<p>而我在Read Later Fast 的content script中像页面添加 page saved/link saved 的 notification是用的第二种方式。而由我接手的Quick Note在页面中添加笔记的插入sidebar的方式我也将在下一版本中换成第二种方式。</p>
<p>之所以这样，是因为之前用第一种方式，重写HTML后，可能会造成页面原有的javascript失效，尤其是那种主要是由javascript构架的站点，而换成第二种方式便不会造成这类问题。</p>
<p>这就是为什么以前版本的Read Later Fast 以及当前还在的Quick Note版本在某些页面使用时会导致当前页面的js工作不正常，比如google reader。</p>
<p>当然比较推荐的办法还是去使用jquery来创建DOM。</p>
<p>用哪种方式，看你测试出来是否有副作用。一般来说 innerHTML只要不是针对body的话，一般都不会存在我提到的这个问题。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/04/12/jetpackcustomizeadd-onshixianfangshi/" itemprop="url">
                  jetpack add-on customize实现办法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Postado em
            <time itemprop="dateCreated" datetime="2011-04-12T15:06:58+08:00" content="2011-04-12">
              2011-04-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; Em
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Browser/" itemprop="url" rel="index">
                    <span itemprop="name">Browser</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Browser/Firefox/" itemprop="url" rel="index">
                    <span itemprop="name">Firefox</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Browser/Firefox/工作记录/" itemprop="url" rel="index">
                    <span itemprop="name">工作记录</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>前面有一篇关于不建议使用jetpack来开发firefox add-on的文章，无奈，手里的项目已经是jetpack的东西，所以只能一条路走到黑。<br>之前有提到说使用jetpack开发的add-On用户不能自定义add-on的位置，这两天查了下MDN，发现XUL有一个叫customization的事件（<a href="https://developer.mozilla.org/en/XUL/Toolbars/Toolbar_customization_events" target="_blank" rel="external">https://developer.mozilla.org/en/XUL/Toolbars/Toolbar_customization_events</a>），感觉应该有办法来实现使用jetpack开发的add-on的自定义。</p>
<p><em><span style="color: #993300;">注：使用下面说到的方法前提是你是使用我之前提到的插入button的方法，而不是使用jetpack的widget方法，参考：<a href="http://blog.liuyixi.com/index.php/820">http://blog.liuyixi.com/index.php/820</a></span></em></p>
<p><em><span style="color: #993300;"><a href="http://blog.liuyixi.com/index.php/820"></a></span></em><br>实现自定义首先需要把我们创建的DOM注册到自定义面板中：</p>
<pre lang="javascript" line="1" file="download.txt" colla="+">
doc.getElementById("navigator-toolbox").palette.appendChild(newItem);
</pre>
注册到面板中后
因为我们的button是通过创建DOM的方式添加到toolbar上面的，所以只要记住自定义后add-on的位置，然后下一次添加DOM的时候根据这个记住的位置添加即可实现。

具体如下：

首先我们需要在simple-storage中初始化一些值，用于判断第一次安装时插入的位置，这部分的代码只需要执行一次，故在前面加上了一个if判断

<pre lang="javascript" line="1" file="download.txt" colla="+">
var s_flag = simpleStorage.storage.storagecreate;
if(s_flag!=1)
{
  console.log('initstorage');
  simpleStorage.storage = {
    b_parent:'nav-bar',
    b_next:null,
    storagecreate:1
  }
}
</pre>

<p>然后是添加button部分的代码：</p>
<pre lang="javascript" line="1" file="download.txt" colla="+">
 var win = win||mediator.getMostRecentWindow("navigator:browser");
  var doc =win.document;
  //add toolbar button
  var newItem = doc.createElement("toolbarbutton");
  newItem.setAttribute('tooltiptext','Read Later Fast');
  newItem.id = 'read-later-fast';
  newItem.className = "toolbarbutton-1 chromeclass-toolbar-additional";
  newItem.setAttribute('image',data.url('icon20.png'));
  newItem.onmousedown = function(e) {
    if(e.which==1) tabs.open({url:data.url('RLF.html')});
  }
  doc.getElementById("navigator-toolbox").palette.appendChild(newItem);
  var b_parent = simpleStorage.storage.b_parent;
  var b_next = simpleStorage.storage.b_next;
  console.log(b_parent,b_next);
  if(b_next!=null){
    var before = doc.getElementById(b_next); 
  }else{
    var before = null;
  }
  if(b_parent!=null){
    var parentNode = doc.getElementById(b_parent);
    parentNode.insertItem('read-later-fast', before, null, false);
  }
</pre>
最后是监听自定义add-on位置的代码，原理是当用户完成自定义事件时，触发aftercustomization事件，这个时候记录下我们插件的parentNode ID 和 nextSibling的ID，下次添加的时候便根据这两个位置来添加以实现保存位置的目的。需要注意的是，当用户把button拖回到面板中时，这个时候是无法获取到dom的，所以将记录的位置赋值为null：
<pre lang="javascript" line="1" file="download.txt" colla="+">
var win_cus = mediator.getMostRecentWindow("navigator:browser");
win_cus.addEventListener("aftercustomization", customizeEnd, false);
var doc_cus =win_cus.document;

function customizeEnd(e) {
  let theToolbox = e.target;
  var rlf = doc_cus.getElementById('read-later-fast');
  if(rlf==null){
    simpleStorage.storage.b_parent=simpleStorage.storage.b_next=null
  }else{
    simpleStorage.storage.b_parent = rlf['parentNode'].id;
    simpleStorage.storage.b_next = rlf['nextSibling'].id;
  }
  storagecreateflag = simpleStorage.storage.storagecreate;
}
</pre>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/04/11/gbkagbknitaifanrenleiliao/" itemprop="url">
                  GBK啊GBK，你太反人类了
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Postado em
            <time itemprop="dateCreated" datetime="2011-04-11T16:35:06+08:00" content="2011-04-11">
              2011-04-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; Em
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Firefox/" itemprop="url" rel="index">
                    <span itemprop="name">Firefox</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Firefox/工作记录/" itemprop="url" rel="index">
                    <span itemprop="name">工作记录</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>卧槽，Read Later Fast   firefox4版本取一些GBK编码的网页乱码问题，纠结了我4天了，还是仍然无头绪。</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2011/04/08/bujianyishiyongjetpackadd-onsdkkaifafirefoxkuozhan/" itemprop="url">
                  不建议使用jetpack(Add-On SDK)开发 Firefox扩展
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            Postado em
            <time itemprop="dateCreated" datetime="2011-04-08T11:51:31+08:00" content="2011-04-08">
              2011-04-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; Em
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Firefox/" itemprop="url" rel="index">
                    <span itemprop="name">Firefox</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Firefox/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
                  , 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Firefox/javascript/工作记录/" itemprop="url" rel="index">
                    <span itemprop="name">工作记录</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <p>Firefox4现在正式版已经发布，虽然mozilla在推荐使用jetpack（Add-On SDK）来开发Firefox的Add-on，或许以后还会主要推荐使用jetpack来开发插件，从而慢慢抛弃以前传统的XUL的方式。但至少现在，我不推荐使用jetpack来开发插件，原因有下面几点。</p>
<p>1，UI的限制性</p>
<p>开发一个扩展，想好需求后，就要考虑你将扩展的入口放在什么位置，而Firefox的开放性，使用传统的开发方式可以几乎在Firefox的任何位置进行自定义。但如果使用jetpack开发，API提供的UI只有两个，一个是widget（即Firefox4的Add-on Bar），一个是context menu。Firefox4的add-on bar上面放一个icon非常的不显眼，且很容易被关闭，一旦关闭后，用户就很难再找到扩展的入口了。然后是context menu，jetpack中提供的参数很基本，比如你不能给context menu的前面加上icon。好吧这些都没事，但还有个更大的问题，扩展图标的位置不能自定义！虽然能拖到其他的各个位置，但拖动后你就会发现有各种的诡异问题。而且下一次重启后就会恢复原来的位置。</p>
<p><a href="http://blog.liuyixi.com/wp-content/uploads/2011/04/ff1.jpg"><img src="http://blog.liuyixi.com/wp-content/uploads/2011/04/ff1.jpg" alt="" title="ff1"></a></p>
<p>看到没，因为使用jetpack生成的icon没有button的样式，拖上去后会导致toolbar压缩，很诡异。</p>
<p>关于图标入口位置的定义，当然接触过传统开发办法的童鞋可能会想到一个办法，使用XPCOM来插入。比如上图中右上角我的项目 Read Later Fast也是用jetpack开发的。</p>
<p>具体实现方式如下，首先引用jetpack中的chrome模块来调用XPCOM，然后通过XPCOM来向browser.xul插入DOM。</p>
<p><pre lang="javascript" line="1" file="download.txt" colla="+"><br>var {Cc, Ci,Cu,Cr,Cm} = require(“chrome”);<br>var mediator = Cc[‘@mozilla.org/appshell/window-mediator;1’]<br>.getService(Ci.nsIWindowMediator);<br>var win = win||mediator.getMostRecentWindow(“navigator:browser”);<br>  var doc =win.document;</p>
<p>  //add toolbar button<br>  var addonBar = doc.getElementById(“nav-bar”);<br>  if(addonBar!=undefined){<br>    var newItem = doc.createElement(“toolbarbutton”);<br>    newItem.setAttribute(‘tooltiptext’,’Read Later Fast’);<br>    addonBar.appendChild(newItem);<br>    newItem.id = ‘read-later-fast’;<br>    newItem.className = “toolbarbutton-1 chromeclass-toolbar-additional”;<br>    newItem.image= data.url(‘icon20.png’);<br>    newItem.onmousedown = function(e) {<br>      if(e.which==1) tabs.open({url:data.url(‘RLF.html’)});<br>    }<br>  }</pre><br>这个方式比较诡异，虽然实现了在toolbar中插入icon，但是你在卸载或者禁用扩展时，icon并不会消失，在你新打开窗口时，新窗口中也没有icon的添加，对于这些情况你还需要写一些代码来特殊处理，如果需要了解，可以在评论中和我讨论。当然用这个方法，可以在firefox任何地方按照像以前XUL方式原理来自定义，但你需要花更麻烦的方法来处理带来的副作用，比如刚才提到的icon消失之类的问题。</p>
<p>2.扩展大小问题<br>
          <div class="post-more-link text-center">
            <a class="btn" href="/2011/04/08/bujianyishiyongjetpackadd-onsdkkaifafirefoxkuozhan/#more" rel="contents">
              Ler mais &raquo;
            </a>
          </div>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="一兮" itemprop="image"/>
          <p class="site-author-name" itemprop="name">一兮</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">176</span>
              <span class="site-state-item-name">publicações</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">41</span>
              <span class="site-state-item-name">categorias</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">123</span>
              <span class="site-state-item-name">tags</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">一兮</span>
</div>

<div class="powered-by">
  Desenvolvido com amor com <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Tema -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
